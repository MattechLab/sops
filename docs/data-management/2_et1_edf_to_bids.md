Derived from [edf_to_bids](https://www.axonlab.org/hcph-sops/data-management/edf-to-bids/) and [convert.py](https://github.com/TheAxonLab/hcph-sops/blob/mkdocs/code/eyetracking/convert.py)
Hsop: Converting eye-tracking into BIDS - Standard Operating Procedures of the HCPh project (axonlab.org)
TheAxonLab/hcph-sops (github.com)
 
EyeLink eye tracking system produces EDF recording files. In this step we need to first convert the raw edf files to BIDS format for enforcing a standardized structure, naming conventin and metadata description. It makes researchers easier to undertand and use data from different sources.


- To use pyEDFRead python package, we must properly install the open-source software EyeLink on our device/laptop in the very first step. You can find the instructions [here](0_software_install.md).

- Import the environments
  
```python

from __future__ import annotations 
from pathlib import Path
import pandas as pd
import numpy as np
from pyedfread import read_edf
from collections import defaultdict
from itertools import product, groupby
from warnings import warn
import re
```

- Use `pyedfread` package to open edf and 

```python 
DATA_PATH = Path("/Path/to/EDF folder")
edf_name = f"file1.EDF"

file_path = str(DATA_PATH / edf_name)
print(file_path)
ori_recording, ori_events, ori_messages = read_edf(file_path)
```
The edf file will generate Pandas dataframes:
        - `ori_recording`: The ET recordings with trajectory information, pupil area and other information.
        - `ori_events`: contains information of task events.
        - `ori_messages`: log messages including ET calibration, validation and user-defined task messages sent from Psychopy program to the device.

```python
ori_messages = ori_messages.rename(
    columns={
        # Normalize weird header names generated by pyedfread
        "message": "trialid",
        "trial": "trial",
        # Convert some BIDS columns
        "time": "timestamp",
    }
)

recording = ori_recording
messages = ori_messages
events = ori_events
print(f'\nThe entire info of `message`: \n{messages}')
recording.columns
```
  
 
 


